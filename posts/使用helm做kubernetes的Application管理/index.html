<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-proxy-endpoint" content="https://blog-enable-page-views.de.r.appspot.com/query?id=ahp6ZGV-YmxvZy1lbmFibGUtcGFnZS12aWV3c3IVCxIIQXBpUXVlcnkYgICAmJSmgwoM"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="010_使用 helm 來管理 application on kubernetes" /><meta name="author" content="owen" /><meta property="og:locale" content="en" /><meta name="description" content="目標 隨著專案越來越多，管理 kubernetes 內部 deployment、service、ingress、configmaps 物件越來越多。對於多檔切換來切換去的管理也越來越不堪負荷，也害怕自己哪裡改壞了，沒正確上到對應的配置導致部署有問題沒發現。最近開始想要導入 helm 來做在 kubernetes 內的 application 做管理。" /><meta property="og:description" content="目標 隨著專案越來越多，管理 kubernetes 內部 deployment、service、ingress、configmaps 物件越來越多。對於多檔切換來切換去的管理也越來越不堪負荷，也害怕自己哪裡改壞了，沒正確上到對應的配置導致部署有問題沒發現。最近開始想要導入 helm 來做在 kubernetes 內的 application 做管理。" /><link rel="canonical" href="https://atorigin.github.io/posts/%E4%BD%BF%E7%94%A8helm%E5%81%9Akubernetes%E7%9A%84Application%E7%AE%A1%E7%90%86/" /><meta property="og:url" content="https://atorigin.github.io/posts/%E4%BD%BF%E7%94%A8helm%E5%81%9Akubernetes%E7%9A%84Application%E7%AE%A1%E7%90%86/" /><meta property="og:site_name" content="Owen" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-17T16:09:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="010_使用 helm 來管理 application on kubernetes" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@owen" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"owen"},"dateModified":"2025-04-04T14:56:31+08:00","datePublished":"2022-08-17T16:09:00+08:00","description":"目標 隨著專案越來越多，管理 kubernetes 內部 deployment、service、ingress、configmaps 物件越來越多。對於多檔切換來切換去的管理也越來越不堪負荷，也害怕自己哪裡改壞了，沒正確上到對應的配置導致部署有問題沒發現。最近開始想要導入 helm 來做在 kubernetes 內的 application 做管理。","headline":"010_使用 helm 來管理 application on kubernetes","mainEntityOfPage":{"@type":"WebPage","@id":"https://atorigin.github.io/posts/%E4%BD%BF%E7%94%A8helm%E5%81%9Akubernetes%E7%9A%84Application%E7%AE%A1%E7%90%86/"},"url":"https://atorigin.github.io/posts/%E4%BD%BF%E7%94%A8helm%E5%81%9Akubernetes%E7%9A%84Application%E7%AE%A1%E7%90%86/"}</script><title>010_使用 helm 來管理 application on kubernetes | Owen</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Owen"><meta name="application-name" content="Owen"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://blog-enable-page-views.de.r.appspot.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://blog-enable-page-views.de.r.appspot.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/commons/sonans.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Owen</a></div><div class="site-subtitle font-italic">只有累積，沒有奇蹟</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/atorigin" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/yanghongyuan/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>010_使用 helm 來管理 application on kubernetes</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>010_使用 helm 來管理 application on kubernetes</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1660723740" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 17, 2022 </em> </span> <span> Updated <em class="" data-ts="1743749791" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 4, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> OwenYang </em> </span><div> <span> <em id="pv" class="pageviews"> <i class="fas fa-spinner fa-spin fa-fw"></i> </em> views </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2341 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><h1 id="目標">目標</h1><p>隨著專案越來越多，管理 kubernetes 內部 deployment、service、ingress、configmaps 物件越來越多。對於多檔切換來切換去的管理也越來越不堪負荷，也害怕自己哪裡改壞了，沒正確上到對應的配置導致部署有問題沒發現。最近開始想要導入 helm 來做在 kubernetes 內的 application 做管理。</p><h1 id="測試開發-chart-心得總結">測試開發 Chart 心得總結</h1><ul><li>跟 golang template 有很大的關係，裡面語法大都類似<li>當要利用模板渲染時，要注意 scope，比較要注意的是 <code class="language-plaintext highlighter-rouge">with</code> 關鍵字。<li>條件控制 if-else 和 range 比較常用，range 雷同 foreach 的功能<li>要注意 template render 後的空格，適時的使用 <code class="language-plaintext highlighter-rouge">{{-</code> 和 <code class="language-plaintext highlighter-rouge">-}}</code> 絕大部分情況會用 <code class="language-plaintext highlighter-rouge">{{-</code><li>模板定義會用 <code class="language-plaintext highlighter-rouge">define</code> 包起來，並且 helm 建議所有定義都放在 <code class="language-plaintext highlighter-rouge">_helpers.tpl</code> 檔案裡<li>使用 <code class="language-plaintext highlighter-rouge">include</code> 或 <code class="language-plaintext highlighter-rouge">template</code> 引入模板，兩者差異在於 <code class="language-plaintext highlighter-rouge">include</code> 是 function，他可以透過 <code class="language-plaintext highlighter-rouge">|</code> 再次做數據處理，而 <code class="language-plaintext highlighter-rouge">template</code> 僅是執行複製貼上的動作，所以無法將輸出傳入給另一個 function 做輸入，因此 helm 建議用 <code class="language-plaintext highlighter-rouge">include</code> 可以更好的處理縮進問題</ul><h1 id="chart-基本概念">Chart 基本概念</h1><h2 id="helm-安裝-resource-的順序"><span class="mr-2">Helm 安裝 resource 的順序</span><a href="#helm-安裝-resource-的順序" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://helm.sh/docs/intro/using_helm/">https://helm.sh/docs/intro/using_helm/</a></p><h2 id="chart-基本結構"><span class="mr-2">Chart 基本結構</span><a href="#chart-基本結構" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="s">mychart/</span>
    <span class="s">Chart.yaml</span>
    <span class="s">values.yaml</span>
    <span class="s">charts/</span>
    <span class="s">templates/</span>
    <span class="s">...</span>
</pre></table></code></div></div><ul><li>templates 目錄存放 template 檔案，helm 在運行 chart 的同時，會將所有 templates 目錄裡面的檔案發送給 template rendering engine(模板渲染引擎)<li>values.yaml 檔案對於 template 非常重要，這個檔案包含在整個 charts 的default values，當執行 <code class="language-plaintext highlighter-rouge">helm install</code> 或 <code class="language-plaintext highlighter-rouge">helm upgrade</code> 這些 values 會被用來覆寫。<li>Chart.yaml 包含整個 chart 的描述，可以在 template 裡面訪問 Chart.yaml，而 charts/ 目錄會包含其他 chart，也可稱作為 subcharts</ul><h2 id="初探-templates-目錄的檔案"><span class="mr-2">初探 templates/ 目錄的檔案</span><a href="#初探-templates-目錄的檔案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>NOTES.txt，一些提示字串，用來幫助安裝 chart 的時候顯示給 user 看的描述。<li>deployment.yaml，基礎的 manifest，就是 kubernetes 的 deployment 物件。<li>service.yaml，基礎的 manifest，就是 kubernetes 的 service 物件。<li>_helpers.tpl，存放可以讓這個 chart 被重用的模板協助器。</ul><blockquote class="prompt-tip"><div><p>template 雖然沒有強制性規定命名規則，但 helm 建議還是用 <code class="language-plaintext highlighter-rouge">.yaml</code> 來作為 YAML 檔案的 suffix，且用 <code class="language-plaintext highlighter-rouge">.tpl</code> 作為模板協助器檔案的 suffix</p></div></blockquote><h2 id="測試基本渲染-template-的方式"><span class="mr-2">測試基本渲染 template 的方式</span><a href="#測試基本渲染-template-的方式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="先創建-helm-chart"><span class="mr-2">先創建 helm chart</span><a href="#先創建-helm-chart" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm create demo
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>demo 為 chart name 可以隨意取，完成後會依照取的名子生成一個目錄。</p></div></blockquote><h3 id="移除-templates-目錄下所有檔案"><span class="mr-2">移除 templates/ 目錄下所有檔案</span><a href="#移除-templates-目錄下所有檔案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">rm</span> <span class="nt">-rf</span> demo/templates/<span class="k">*</span>
</pre></table></code></div></div><h3 id="在-templates-目錄下新增一個-configmapsyaml-檔案"><span class="mr-2">在 templates/ 目錄下新增一個 <code class="language-plaintext highlighter-rouge"><span class="mr-2">configmaps.yaml</code> 檔案</span><a href="#在-templates-目錄下新增一個-configmapsyaml-檔案" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Release.Name</span> <span class="pi">}}</span><span class="s">-configmap</span> 
<span class="na">data</span><span class="pi">:</span>
  <span class="na">myvalue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
</pre></table></code></div></div><blockquote class="prompt-info"><div><p>這邊的關鍵在 metadata 下面的 name，後面用了一個 <code class="language-plaintext highlighter-rouge">{{ .Release.Name }}</code> 。</p></div></blockquote><h3 id="關於---releasename--的解讀"><span class="mr-2">關於 {{ .Release.Name }} 的解讀</span><a href="#關於---releasename--的解讀" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>這邊的定義可以解讀為，從 top namespace 開始找 Release 物件，並從 Release 物件裡找到一個物件叫做 Name 的。</p><blockquote class="prompt-tip"><div><p>Release 物件是 helm 物件的一種</p></div></blockquote><h2 id="helm-內建的物件"><span class="mr-2">helm 內建的物件</span><a href="#helm-內建的物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>把定義的物件透過 template engine 傳入 template<li>測試 <code class="language-plaintext highlighter-rouge">with</code> 和 <code class="language-plaintext highlighter-rouge">range</code> statements<li>甚至有方法能直接在 template 裡面 new 一個物件，例如用 <code class="language-plaintext highlighter-rouge">tuple</code> function</ul><blockquote class="prompt-tip"><div><p>物件可以單純是一個值，或是其它物件或 functions。</p></div></blockquote><h3 id="release-物件"><span class="mr-2">Release 物件</span><a href="#release-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Release 物件是在 template 中可以訪問的最高級物件<li>Release 物件用來描述它自己本身，它內部有幾個物件<ul><li>Release.Name 該 release 的名稱<li>Release.Namespace 該 namespace，如果 manifest 裡面沒有宣告<li>Release.Revision 該 release 的 revision 號碼，install 後為 1，往後 upgrade 會往上加，或 rollback 往下減</ul></ul><h3 id="values-物件"><span class="mr-2">Values 物件</span><a href="#values-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Values 透過 values.yaml 檔案傳入 template，預設情況下 Values 是空的</ul><h3 id="chart-物件"><span class="mr-2">Chart 物件</span><a href="#chart-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>是 Chart.yaml 檔案的內容<li>在 Chart.yaml 檔案內的可用參數可參考 <a href="https://helm.sh/docs/topics/charts/#the-chartyaml-file">https://helm.sh/docs/topics/charts/#the-chartyaml-file</a></ul><h3 id="files-物件"><span class="mr-2">Files 物件</span><a href="#files-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>用來提供在 charts 裡面訪問所有非特定 (non-special) 的檔案<li>檔案物件的使用方式，參考 <a href="https://helm.sh/docs/chart_template_guide/accessing_files/">https://helm.sh/docs/chart_template_guide/accessing_files/</a></ul><h3 id="capabilities-物件"><span class="mr-2">Capabilities 物件</span><a href="#capabilities-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>提供 kubernetes cluster 支援的資訊</ul><h3 id="template-物件"><span class="mr-2">Template 物件</span><a href="#template-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>包含當前被執行的 template 的資訊</ul><blockquote class="prompt-info"><div><p>補充，在 Go 裡面，大寫字母開頭通常被用來表示 build-in 的物件。是 Go 的命名原則。</p></div></blockquote><h2 id="進一步探討上面提到的-value-物件"><span class="mr-2">進一步探討上面提到的 Value 物件</span><a href="#進一步探討上面提到的-value-物件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>它可以透過多個來源來傳入 chart<ul><li>該 chart 裡面的 values.yaml 檔案<li>如果是 subchart，來自 parent chart 的 values.yaml<li>執行 command 時帶入的 <code class="language-plaintext highlighter-rouge">-f</code> 參數的指定 values.yaml 檔案<ul><li>例如 <code class="language-plaintext highlighter-rouge">helm install -f myvalues.yaml ./mychart</code></ul><li>執行 command 時代入的 <code class="language-plaintext highlighter-rouge">--set</code> 參數指定的方式<ul><li>例如 <code class="language-plaintext highlighter-rouge">helm install --set foo=bar ./mychart</code></ul></ul></ul><h3 id="順序優先級"><span class="mr-2">順序優先級</span><a href="#順序優先級" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>values.yaml 是最先的<li>如果 subchart 內的 values.yaml 值不存在，調用 parent 的 values.yaml 來覆蓋<li>而這些 values.yaml 檔可以被 user 定義的 <code class="language-plaintext highlighter-rouge">-f</code> 和 <code class="language-plaintext highlighter-rouge">--set</code> 參數覆蓋</ul><blockquote class="prompt-tip"><div><p>測試為 <code class="language-plaintext highlighter-rouge">--set foo=bar</code> &gt; <code class="language-plaintext highlighter-rouge">-f myvalue.yaml</code> &gt; <code class="language-plaintext highlighter-rouge">values.yaml</code></p></div></blockquote><h1 id="延續基礎在-template-中如何把內容再進一步做轉換變成我們想要用的內容">延續基礎，在 template 中如何把內容再進一步做轉換變成我們想要用的內容</h1><h2 id="假想一種情況"><span class="mr-2">假想一種情況</span><a href="#假想一種情況" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>前面我們透過 {{ .Release.Name }} 的方式把 template 字元轉換成我們要的內容，但這種方式為固定一組對應的轉換，但隨著內容越來越複雜，我們會遇到要將內容轉換的同時，對這些內容作”再處理”。以下將使用 .Values 物件展示部分 Case。</p><h2 id="在-inject-到-template-時用-quote--將內容包住"><span class="mr-2">在 inject 到 template 時，用 quote (“”) 將內容包住</span><a href="#在-inject-到-template-時用-quote--將內容包住" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Release.Name</span> <span class="pi">}}</span><span class="s">-configmap</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">myvalue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
  <span class="na">drink</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">quote .Values.favorite.drink</span> <span class="pi">}}</span>
  <span class="na">food</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">quote .Values.favorite.food</span> <span class="pi">}}</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>其實 helm template language 跟 go template language 類似</p></div></blockquote><h2 id="default-function"><span class="mr-2">default function</span><a href="#default-function" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>是非常常使用的 function，該 function 可以指定一個預設的 value 在 template 裡面。例如：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="na">drink</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.favorite.drink | default "tea" | quote</span> <span class="pi">}}</span>
</pre></table></code></div></div><h1 id="談談-templates_helpertpl-檔案">談談 templates/_helper.tpl 檔案</h1><ul><li>最主要是設計來讓所有 template 都可以 re-use 的字段<li>先 define 一個 block 名稱 -&gt; 在 template 裡面透過 template 關鍵字或 include 關鍵字找到 _helper.tpl 內定義的 block 名稱，引入到該 template 裡面</ul><h2 id="具體實踐"><span class="mr-2">具體實踐</span><a href="#具體實踐" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>先建置一個 _helper.tpl 檔案，並定義 fullname 區塊<li>新增一個 configmaps template 並定義 include 關鍵字，使其能引用 _helper.tpl 的值</ol><h3 id="_helpertpl"><span class="mr-2">_helper.tpl</span><a href="#_helpertpl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>{{/*
Create a default fully qualified app name.
We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
If release name contains chart name it will be used as a full name.
*/}}
{{- define "fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- $name := default .Chart.Name .Values.nameOverride }}
{{- if contains $name .Release.Name }}
{{- .Release.Name | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
{{- end }}
</pre></table></code></div></div><h3 id="configmapsyaml"><span class="mr-2">configmaps.yaml</span><a href="#configmapsyaml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">fair-worm-configmap</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">myvalue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
  <span class="na">drink</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.favorite.drink | default (printf "%s-tea" (include "fullname" .))</span> <span class="pi">}}</span>
  <span class="na">food</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PIZZA"</span>
</pre></table></code></div></div><h3 id="執行-helm-指令查看生成的-object-樣子"><span class="mr-2">執行 helm 指令查看生成的 object 樣子</span><a href="#執行-helm-指令查看生成的-object-樣子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm template demo <span class="nb">.</span>
</pre></table></code></div></div><p><img data-src="/commons/image/20220818/000_helm.png" alt="" data-proofer-ignore></p><blockquote class="prompt-info"><div><p>demo 可以隨意，這個參數所代表的意義是 chart name</p></div></blockquote><h1 id="常用-function-整理">常用 function 整理</h1><h2 id="date-相關的"><span class="mr-2">Date 相關的</span><a href="#date-相關的" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>now 取得當前的時間，常用來搭配其他時間 function<li>date 格式化時間</ul><blockquote class="prompt-warning"><div><p>Golang 的 time 套件在 format 時間字串時有自己定義的做法。他不像其他語言用 %D 或 %Y 之類的代碼，而是直接用一個自訂標準時間，它的規律就像計數 12345 那樣。</p></div></blockquote><h3 id="例如宣告以下的-function我們會得到-utc8-的標準-24-小時制當前時間"><span class="mr-2">例如宣告以下的 function，我們會得到 UTC+8 的標準 24 小時制當前時間</span><a href="#例如宣告以下的-function我們會得到-utc8-的標準-24-小時制當前時間" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="pi">{{</span> <span class="nv">now | date "2006-01-02 15</span><span class="pi">:</span><span class="nv">04</span><span class="pi">:</span><span class="nv">05 +0800"</span> <span class="pi">}}</span>
</pre></table></code></div></div><h2 id="string-相關的"><span class="mr-2">String 相關的</span><a href="#string-相關的" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>contains，用來測試字串內有無包含特定的字，返回 true 或 false<ul><li>範例 <code class="language-plaintext highlighter-rouge">contains "cat" "catch"</code>，返回 <code class="language-plaintext highlighter-rouge">true</code></ul><li>quote 和 squote，把 String 用雙引號(quote)或單引號(squote)包起來<ul><li>範例 <code class="language-plaintext highlighter-rouge">"hello" | quote</code> ，返回 <code class="language-plaintext highlighter-rouge">"hello"</code></ul><li>indent，會把字串用空格縮排，nindent 跟 indent 一樣，但會在一開始先空一行<ul><li>範例 <code class="language-plaintext highlighter-rouge">indent 4 "hello"</code> 返回 <code class="language-plaintext highlighter-rouge">" hello"</code></ul><li>replace，取代字串<ul><li>範例 <code class="language-plaintext highlighter-rouge">"I have a pen" | replace " " "-"</code> 返回 <code class="language-plaintext highlighter-rouge">"I-have-a-pen"</code></ul></ul><h2 id="其他參考"><span class="mr-2">其他參考</span><a href="#其他參考" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="https://helm.sh/docs/chart_template_guide/function_list/">https://helm.sh/docs/chart_template_guide/function_list/</a></p><h1 id="flow-control-重點摘要">flow control 重點摘要</h1><h2 id="甚麼情況會判斷為-false"><span class="mr-2">甚麼情況會判斷為 false</span><a href="#甚麼情況會判斷為-false" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li>直接給定 boolean 為 false 時<li>當數字型別為 0 時<li>空字串 <code class="language-plaintext highlighter-rouge">""</code> 時<li>出現 <code class="language-plaintext highlighter-rouge">nil</code> 關鍵字時<li>出現空的 collection 時(無論是 map / slice / tuple / dict / array)</ol><h2 id="排版問題"><span class="mr-2">排版問題</span><a href="#排版問題" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>在 template engine 渲染過程，會把 <code class="language-plaintext highlighter-rouge">{{ 中間內容 }}</code> 大括號對的內容刪除並且保留其空白，而最後渲染出來就會變成多了空格，文件舉例</p><h3 id="當我們給定一個這樣的-configmapsyaml"><span class="mr-2">當我們給定一個這樣的 configmaps.yaml</span><a href="#當我們給定一個這樣的-configmapsyaml" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Release.Name</span> <span class="pi">}}</span><span class="s">-configmap</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">myvalue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
  <span class="na">drink</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.favorite.drink | default "tea" | quote</span> <span class="pi">}}</span>
  <span class="na">food</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.favorite.food | upper | quote</span> <span class="pi">}}</span>
  <span class="pi">{{</span> <span class="nv">if eq .Values.favorite.drink "coffee"</span> <span class="pi">}}</span>
  <span class="na">mug</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="pi">{{</span> <span class="nv">end</span> <span class="pi">}}</span>
</pre></table></code></div></div><h3 id="渲染結果會變成"><span class="mr-2">渲染結果會變成</span><a href="#渲染結果會變成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">telling-chimp-configmap</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">myvalue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
  <span class="na">drink</span><span class="pi">:</span> <span class="s2">"</span><span class="s">coffee"</span>
  <span class="na">food</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PIZZA"</span>

  <span class="na">mug</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
</pre></table></code></div></div><blockquote class="prompt-tip"><div><p>可以看到 food 和 mug 之間多了一行空白</p></div></blockquote><h3 id="這時候-helm-提供的作法是去除空白在大括號後加上---符號來告訴-template-engine-把空格處理掉這邊要注意的是在-helm-裡面渲染後的換行就等同於空格因此我們可以改成"><span class="mr-2">這時候 helm 提供的作法是去除空白，在大括號後加上 <code class="language-plaintext highlighter-rouge"><span class="mr-2">-</code> 符號來告訴 template engine 把空格處理掉，這邊要注意的是，在 helm 裡面，渲染後的換行就等同於空格，因此我們可以改成</span><a href="#這時候-helm-提供的作法是去除空白在大括號後加上---符號來告訴-template-engine-把空格處理掉這邊要注意的是在-helm-裡面渲染後的換行就等同於空格因此我們可以改成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Release.Name</span> <span class="pi">}}</span><span class="s">-configmap</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">myvalue</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
  <span class="na">drink</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.favorite.drink | default "tea" | quote</span> <span class="pi">}}</span>
  <span class="na">food</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.favorite.food | upper | quote</span> <span class="pi">}}</span>
  <span class="pi">{{</span><span class="nv">- if eq .Values.favorite.drink "coffee"</span> <span class="pi">}}</span>
  <span class="na">mug</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
  <span class="pi">{{</span><span class="nv">- end</span> <span class="pi">}}</span>
</pre></table></code></div></div><blockquote class="prompt-warning"><div><p>注意，{{- 代表是清除左邊的空格，而 -}} 代表是去除右邊的</p></div></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>DevOps</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/helm/" class="post-tag no-text-decoration" >helm</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Podman%E5%AE%89%E8%A3%9D%E5%9C%A8WSL2%E7%9A%84%E5%9D%91/">023_探索 Podman 整合 Windows WSL2 的過程</a><li><a href="/posts/Java%E8%AA%B2%E7%A8%8BDay8/">016_Java 課程 Day8</a><li><a href="/posts/Java%E8%AA%B2%E7%A8%8BDay9/">017_Java 課程 Day9</a><li><a href="/posts/Java%E8%AA%B2%E7%A8%8BDay10/">018_Java 課程 Day10</a><li><a href="/posts/Java%E8%AA%B2%E7%A8%8BDay11/">019_Java 課程 Day11</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloudflare/">cloudflare</a> <a class="post-tag" href="/tags/github-pages/">github-pages</a> <a class="post-tag" href="/tags/gcp/">gcp</a> <a class="post-tag" href="/tags/google-analytics/">google-analytics</a> <a class="post-tag" href="/tags/helm/">helm</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/system/">system</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/2024KubeSummit/"><div class="card-body"> <em class="small" data-ts="1729612800" data-df="ll" > Oct 23, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>022_2024 KubeSummit</h3><div class="text-muted small"><p> 聆聽的議程 Day1 10:00 ~ 10:30 10:50 ~ 11:20 11:40 ~ 12:20 13:20 - 14:00 Day2 9:50 ~ 10:30 10:50 ~ 11:30 11:50 ~ 12:20 13:20 ~ 14:00 1 - 說明 GKE 跟 GKE 與 AI 一起應用的場景 Kubernetes + A...</p></div></div></a></div><div class="card"> <a href="/posts/AWS%E4%B9%8BEKS%E6%A6%82%E5%BF%B5%E6%8E%A2%E7%B4%A2/"><div class="card-body"> <em class="small" data-ts="1658304720" data-df="ll" > Jul 20, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>003_AWS 之 EKS 概念探索</h3><div class="text-muted small"><p> 起源 在想要進一步透過 terraform 配置 AWS EKS 叢集的相關設定時，對於在使用場景和部分名詞定義上的觀念有模糊不清且對其具體影響也不了解，故留下此篇文章來加強自己對於 EKS 這個服務的功能更進一步的了解並在往後合適的時機能夠加以應用。 關於 node 的種類及其差異 總的來說，node 種類分為三種。分別是 self-managed、managed、fargate。而參考...</p></div></div></a></div><div class="card"> <a href="/posts/EKS%E9%83%A8%E7%BD%B2ExternalDNS%E6%95%B4%E5%90%88Cloudflare/"><div class="card-body"> <em class="small" data-ts="1658874240" data-df="ll" > Jul 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>004_EKS 部署 ExternalDNS 整合 Cloudflare</h3><div class="text-muted small"><p> 起源 在部署、上線一個新專案時，通常我們會先寫好該專案的一些 yaml 配置檔，包含 deployment / service / ingress / configmap 等等。將服務的一系列會用的的資源定義好，最後 apply 到 cluster 裡面。 而最後一步，我們通常需要依據定義的 ingress 裡面的 host 來將 DNS Record 建立在 DNS Provider 上...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Java%E8%AA%B2%E7%A8%8BDay4/" class="btn btn-outline-primary" prompt="Older"><p>009_Java 課程 Day4</p></a> <a href="/posts/%E9%97%9C%E6%96%BCSpringBoot%E6%A1%86%E6%9E%B6%E7%9A%84%E9%85%8D%E7%BD%AE%E9%AD%94%E8%A1%93/" class="btn btn-outline-primary" prompt="Newer"><p>011_關於 SpringBoot 框架的配置魔術</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/atorigin">OwenYang</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/cloudflare/">cloudflare</a> <a class="post-tag" href="/tags/github-pages/">github-pages</a> <a class="post-tag" href="/tags/gcp/">gcp</a> <a class="post-tag" href="/tags/google-analytics/">google-analytics</a> <a class="post-tag" href="/tags/helm/">helm</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/system/">system</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script async src="https://cdn.jsdelivr.net/npm/countup.js@1.9.3/dist/countUp.min.js"></script> <script defer src="/assets/js/dist/pvreport.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3GVVTK7NDL"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3GVVTK7NDL'); }); </script>
